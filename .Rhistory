transition_matrix["mild_2x_1_year", "mild_3x_3_year", 46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-`increased_relapse_2`))) + pmild * mildpartial * (1-(mildpartialcured * (1-`increased_relapse_2`))))) * 0.2) * (1 - mildcuration_rate_46)
transition_matrix["mild_2x_1_year", "mild_3x_4_year", 46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-`increased_relapse_2`))) + pmild * mildpartial * (1-(mildpartialcured * (1-`increased_relapse_2`))))) * 0.07) * (1 - mildcuration_rate_46)
transition_matrix["mild_2x_1_year", "mild_3x_5_year", 46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-`increased_relapse_2`))) + pmild * mildpartial * (1-(mildpartialcured * (1-`increased_relapse_2`))))) * 0.03) * (1 - mildcuration_rate_46)
### Mild 4x
transition_matrix["mild_3x_1_year", "mild_4x_1_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_3))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_3))))) * 0.4) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_3x_1_year", "mild_4x_2_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_3))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_3))))) * 0.3) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_3x_1_year", "mild_4x_3_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_3))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_3))))) * 0.2) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_3x_1_year", "mild_4x_4_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_3))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_3))))) * 0.07) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_3x_1_year", "mild_4x_5_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_3))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_3))))) * 0.03) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
### Mild 5x
transition_matrix["mild_4x_1_year", "mild_5x_1_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_4))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_4))))) * 0.4) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_4x_1_year", "mild_5x_2_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_4))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_4))))) * 0.3) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_4x_1_year", "mild_5x_3_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_4))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_4))))) * 0.2) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_4x_1_year", "mild_5x_4_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_4))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_4))))) * 0.07) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["mild_4x_1_year", "mild_5x_5_year",46] <- (leavemodel/pmild * (relapsecure * (pmild * mildrecovery * (1-(mildrecoverycured*(1-increased_relapse_4))) + pmild * mildpartial * (1-(mildpartialcured * (1-increased_relapse_4))))) * 0.03) * (1 - mildcuration_rate_46) * (1 - relapseprevention_rate_46)
### Mild - chronic
transition_matrix["mild_incidence", "mild_chronic", 46] <- (leavemodel/pmild * ((pmild * mildchronic))) * (1 - mildcuration_rate_46)
transition_matrix["mild_1x_1_year", "mild_chronic", 46] <- (leavemodel/pmild * ((pmild*mildchronic))) * (1 - mildcuration_rate_46)
transition_matrix["mild_2x_1_year", "mild_chronic", 46] <- (leavemodel/pmild * ((pmild*mildchronic))) * (1- mildcuration_rate_46)
transition_matrix["mild_3x_1_year", "mild_chronic", 46] <- (leavemodel/pmild * ((pmild*mildchronic))) * (1 - mildcuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["mild_4x_1_year", "mild_chronic", 46] <- (leavemodel/pmild * ((pmild*mildchronic))) * (1 - mildcuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["mild_5x_1_year", "mild_chronic", 46] <-  (1 - (1-leavemodel) - (leavemodel/pmild * ((pmild * mildrecovery * (1-(1-(mildrecoverycured*(1-increased_relapse_5))) * relapsecure) + pmild * mildpartial * (1-(1-(mildpartialcured * (1- increased_relapse_5)))* relapsecure))) + `Fifth episode to chronic`)) * (1 - relapseprevention_rate_46) * (1 - mildcuration_rate_46)
transition_matrix["mild_chronic", "mild_chronic",46] <- 2^(-1/(mean_dur_chron * log(2))) * (leavemodel)
## Moderate
### Moderate 1x
transition_matrix["moderate_incidence", "moderate_1x_1_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * moderaterecoveryrelapse + pmoderate * moderatepartial * moderatepartialrelapse)) * 0.4) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_incidence", "moderate_1x_2_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * moderaterecoveryrelapse + pmoderate * moderatepartial * moderatepartialrelapse)) * 0.3) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_incidence", "moderate_1x_3_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * moderaterecoveryrelapse + pmoderate * moderatepartial * moderatepartialrelapse)) * 0.2) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_incidence", "moderate_1x_4_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * moderaterecoveryrelapse + pmoderate * moderatepartial * moderatepartialrelapse)) * 0.07) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_incidence", "moderate_1x_5_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * moderaterecoveryrelapse + pmoderate * moderatepartial * moderatepartialrelapse)) * 0.03) * (1 - moderatecuration_rate_46)
### moderate 2x
transition_matrix["moderate_1x_1_year", "moderate_2x_1_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_1`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_1`))))) * 0.4) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_1x_1_year", "moderate_2x_2_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_1`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_1`))))) * 0.3) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_1x_1_year", "moderate_2x_3_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_1`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_1`))))) * 0.2) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_1x_1_year", "moderate_2x_4_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_1`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_1`))))) * 0.07) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_1x_1_year", "moderate_2x_5_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_1`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_1`))))) * 0.03) * (1 - moderatecuration_rate_46)
### moderate 3x
transition_matrix["moderate_2x_1_year", "moderate_3x_1_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_2`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_2`))))) * 0.4) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_2x_1_year", "moderate_3x_2_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_2`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_2`))))) * 0.3) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_2x_1_year", "moderate_3x_3_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_2`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_2`))))) * 0.2) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_2x_1_year", "moderate_3x_4_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_2`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_2`))))) * 0.07) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_2x_1_year", "moderate_3x_5_year", 46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-`increased_relapse_2`))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-`increased_relapse_2`))))) * 0.03) * (1 - moderatecuration_rate_46)
### moderate 4x
transition_matrix["moderate_3x_1_year", "moderate_4x_1_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_3))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_3))))) * 0.4) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_3x_1_year", "moderate_4x_2_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_3))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_3))))) * 0.3) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_3x_1_year", "moderate_4x_3_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_3))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_3))))) * 0.2) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_3x_1_year", "moderate_4x_4_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_3))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_3))))) * 0.07) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_3x_1_year", "moderate_4x_5_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_3))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_3))))) * 0.03) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
### moderate 5x
transition_matrix["moderate_4x_1_year", "moderate_5x_1_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_4))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_4))))) * 0.4) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_4x_1_year", "moderate_5x_2_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_4))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_4))))) * 0.3) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_4x_1_year", "moderate_5x_3_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_4))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_4))))) * 0.2) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_4x_1_year", "moderate_5x_4_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_4))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_4))))) * 0.07) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["moderate_4x_1_year", "moderate_5x_5_year",46] <- (leavemodel/pmoderate * (relapsecure * (pmoderate * moderaterecovery * (1-(moderaterecoverycured*(1-increased_relapse_4))) + pmoderate * moderatepartial * (1-(moderatepartialcured * (1-increased_relapse_4))))) * 0.03) * (1 - moderatecuration_rate_46) * (1 - relapseprevention_rate_46)
### moderate - chronic
transition_matrix["moderate_incidence", "moderate_chronic", 46] <- (leavemodel/pmoderate * ((pmoderate * moderatechronic))) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_1x_1_year", "moderate_chronic", 46] <- (leavemodel/pmoderate * ((pmoderate*moderatechronic))) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_2x_1_year", "moderate_chronic", 46] <- (leavemodel/pmoderate * ((pmoderate*moderatechronic))) * (1- moderatecuration_rate_46)
transition_matrix["moderate_3x_1_year", "moderate_chronic", 46] <- (leavemodel/pmoderate * ((pmoderate*moderatechronic))) * (1 - moderatecuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["moderate_4x_1_year", "moderate_chronic", 46] <- (leavemodel/pmoderate * ((pmoderate*moderatechronic))) * (1 - moderatecuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["moderate_5x_1_year", "moderate_chronic", 46] <-  (1 - (1-leavemodel) - (leavemodel/pmoderate * ((pmoderate * moderaterecovery * (1-(1-(moderaterecoverycured*(1-increased_relapse_5))) * relapsecure) + pmoderate * moderatepartial * (1-(1-(moderatepartialcured * (1- increased_relapse_5)))* relapsecure))) + `Fifth episode to chronic`)) * (1 - relapseprevention_rate_46) * (1 - moderatecuration_rate_46)
transition_matrix["moderate_chronic", "moderate_chronic",46] <- 2^(-1/(mean_dur_chron * log(2))) * (leavemodel)
## Severe
### severe 1x
transition_matrix["severe_incidence", "severe_1x_1_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * severerecoveryrelapse + psevere * severepartial * severepartialrelapse)) * 0.4) * (1 - severecuration_rate_46)
transition_matrix["severe_incidence", "severe_1x_2_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * severerecoveryrelapse + psevere * severepartial * severepartialrelapse)) * 0.3) * (1 - severecuration_rate_46)
transition_matrix["severe_incidence", "severe_1x_3_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * severerecoveryrelapse + psevere * severepartial * severepartialrelapse)) * 0.2) * (1 - severecuration_rate_46)
transition_matrix["severe_incidence", "severe_1x_4_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * severerecoveryrelapse + psevere * severepartial * severepartialrelapse)) * 0.07) * (1 - severecuration_rate_46)
transition_matrix["severe_incidence", "severe_1x_5_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * severerecoveryrelapse + psevere * severepartial * severepartialrelapse)) * 0.03) * (1 - severecuration_rate_46)
### severe 2x
transition_matrix["severe_1x_1_year", "severe_2x_1_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_1`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_1`))))) * 0.4) * (1 - severecuration_rate_46)
transition_matrix["severe_1x_1_year", "severe_2x_2_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_1`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_1`))))) * 0.3) * (1 - severecuration_rate_46)
transition_matrix["severe_1x_1_year", "severe_2x_3_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_1`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_1`))))) * 0.2) * (1 - severecuration_rate_46)
transition_matrix["severe_1x_1_year", "severe_2x_4_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_1`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_1`))))) * 0.07) * (1 - severecuration_rate_46)
transition_matrix["severe_1x_1_year", "severe_2x_5_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_1`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_1`))))) * 0.03) * (1 - severecuration_rate_46)
### severe 3x
transition_matrix["severe_2x_1_year", "severe_3x_1_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_2`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_2`))))) * 0.4) * (1 - severecuration_rate_46)
transition_matrix["severe_2x_1_year", "severe_3x_2_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_2`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_2`))))) * 0.3) * (1 - severecuration_rate_46)
transition_matrix["severe_2x_1_year", "severe_3x_3_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_2`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_2`))))) * 0.2) * (1 - severecuration_rate_46)
transition_matrix["severe_2x_1_year", "severe_3x_4_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_2`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_2`))))) * 0.07) * (1 - severecuration_rate_46)
transition_matrix["severe_2x_1_year", "severe_3x_5_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-`increased_relapse_2`))) + psevere * severepartial * (1-(severepartialcured * (1-`increased_relapse_2`))))) * 0.03) * (1 - severecuration_rate_46)
### severe 4x
transition_matrix["severe_3x_1_year", "severe_4x_1_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_3))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_3))))) * 0.4) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_3x_1_year", "severe_4x_2_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_3))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_3))))) * 0.3) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_3x_1_year", "severe_4x_3_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_3))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_3))))) * 0.2) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_3x_1_year", "severe_4x_4_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_3))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_3))))) * 0.07) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_3x_1_year", "severe_4x_5_year", 46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_3))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_3))))) * 0.03) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
### severe 5x
transition_matrix["severe_4x_1_year", "severe_5x_1_year",46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_4))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_4))))) * 0.4) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_4x_1_year", "severe_5x_2_year",46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_4))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_4))))) * 0.3) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_4x_1_year", "severe_5x_3_year",46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_4))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_4))))) * 0.2) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_4x_1_year", "severe_5x_4_year",46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_4))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_4))))) * 0.07) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
transition_matrix["severe_4x_1_year", "severe_5x_5_year",46] <- (leavemodel/psevere * (relapsecure * (psevere * severerecovery * (1-(severerecoverycured*(1-increased_relapse_4))) + psevere * severepartial * (1-(severepartialcured * (1-increased_relapse_4))))) * 0.03) * (1 - severecuration_rate_46) * (1 - relapseprevention_rate_46)
### severe - chronic
transition_matrix["severe_incidence", "severe_chronic", 46] <- (leavemodel/psevere * ((psevere * severechronic))) * (1 - severecuration_rate_46)
transition_matrix["severe_1x_1_year", "severe_chronic", 46] <- (leavemodel/psevere * ((psevere*severechronic))) * (1 - severecuration_rate_46)
transition_matrix["severe_2x_1_year", "severe_chronic", 46] <- (leavemodel/psevere * ((psevere*severechronic))) * (1- severecuration_rate_46)
transition_matrix["severe_3x_1_year", "severe_chronic", 46] <- (leavemodel/psevere * ((psevere*severechronic))) * (1 - severecuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["severe_4x_1_year", "severe_chronic", 46] <- (leavemodel/psevere * ((psevere*severechronic))) * (1 - severecuration_rate_46) * (1-relapseprevention_rate_46)
transition_matrix["severe_5x_1_year", "severe_chronic", 46] <-  (1- (1-leavemodel) - (`Fifth episode to chronic`)) * (1 - relapseprevention_rate_46) * (1 - severecuration_rate_46)
transition_matrix["severe_chronic", "severe_chronic",46] <- 2^(-1/(mean_dur_chron * log(2))) * (leavemodel)
return(transition_matrix)
}
# Population to year 41
population <- array(0,
dim = c(47, length(states)),
dimnames = list(Year = 0:46, state = states))
`Incidence` <- total_population * incidence_no_history
population[1, "mild_incidence"] <- Incidence * pmild
population[1, "moderate_incidence"] <- Incidence * pmoderate
population[1, "severe_incidence"] <- Incidence * psevere
for(i in 2:47){
population[i, ] <- population[i-1, ] %*% transition_matrix[, , i-1]
}
## Take the incidences of the population at year 41 to start the 5 year model
incidence_population_start <- population[42,]
# Calculate the transition probabilities for the 5 years for the base and alternative case --------
simulation_tm_results <- vector("list", sim_runs)
for(i in 1:sim_runs){
simulation_tm_results[[i]] <- func_sim_tm(transition_matrix = transition_matrix)
}
### Take only the last five years of probabilities (year 42 - year 46)
simulation_tm_results_5 <- lapply(simulation_tm_results,
function(x)
x[,,43:47])
# Now simulate the 5 years of the model 1000 times over the base and alternative model -------------------------
new_population <- array(0,
dim = c(6, length(states)),
dimnames = list(Year = 0:5, state = states))
new_population[1, ] <- incidence_population_start
population_sim <- lapply(1:sim_runs, function(x){
new_population
})
for(sim in 1:sim_runs){
new_population <- population_sim[[sim]]
transition_array <- simulation_tm_results_5[[sim]]
for(i in 2:6){
new_population[i,] <- new_population[i-1, ] %*% transition_array[,,i-1]
}
population_sim[[sim]] <- new_population
}
# Store costs and qalys in a list -----------------------------------------
## Calculate the  population, dw, costs & QALYs averted per year per state
### Base population
population_sim <- lapply(population_sim, function(new_population){
mild_population <- rowSums(new_population[, c("mild_incidence",
"mild_1x_1_year",
"mild_2x_1_year",
"mild_3x_1_year",
"mild_4x_1_year",
"mild_5x_1_year",
"mild_chronic")])
moderate_population <- rowSums(new_population[, c("moderate_incidence",
"moderate_1x_1_year",
"moderate_2x_1_year",
"moderate_3x_1_year",
"moderate_4x_1_year",
"moderate_5x_1_year",
"moderate_chronic")])
severe_population <- rowSums(new_population[, c("severe_incidence",
"severe_1x_1_year",
"severe_2x_1_year",
"severe_3x_1_year",
"severe_4x_1_year",
"severe_5x_1_year",
"severe_chronic")])
new_population <- cbind(new_population,
"mild_population" = mild_population,
"moderate_population" = moderate_population,
"severe_population" = severe_population)
return(new_population)
})
### Random probabilities for dw array
dw_p_array <- array(NA_real_,
dim = c(3,5),
dimnames = list(State = c("mild", "moderate", "severe"),
Year = 1:5))
### Simulate random probabilities based on nr of simulations
dw_p_array_sim <- replicate(sim_runs, {
dw_p_array["mild",] <- runif(5, 0, 1)
dw_p_array["moderate",] <- runif(5, 0, 1)
dw_p_array["severe",] <- runif(5, 0, 1)
return(dw_p_array)
}, simplify = FALSE)
### Simulate dw reduction coefficients based on nr of simulations
dw_red_array <- array(NA_real_,
dim = c(3,5),
dimnames = list(State = c("mild", "moderate", "severe"),
Year = 1:5))
dw_red_array_sim <- lapply(dw_p_array_sim, function(dw_p_array){
dw_red_array["mild", 1] <- qnorm(dw_p_array["mild",1], mild, (mild/6))
dw_red_array["mild", 2] <- qnorm(dw_p_array["mild",2], mild, (mild/6))
dw_red_array["mild", 3] <- qnorm(dw_p_array["mild",3], mild, (mild/6))
dw_red_array["mild", 4] <- qnorm(dw_p_array["mild",4], mild, (mild/6))
dw_red_array["mild", 5] <- qnorm(dw_p_array["mild",5], mild, (mild/6))
dw_red_array["moderate", 1] <- qnorm(dw_p_array["moderate",1], moderate, (moderate/6))
dw_red_array["moderate", 2] <- qnorm(dw_p_array["moderate",2], moderate, (moderate/6))
dw_red_array["moderate", 3] <- qnorm(dw_p_array["moderate",3], moderate, (moderate/6))
dw_red_array["moderate", 4] <- qnorm(dw_p_array["moderate",4], moderate, (moderate/6))
dw_red_array["moderate", 5] <- qnorm(dw_p_array["moderate",5], moderate, (moderate/6))
dw_red_array["severe", 1] <- qnorm(dw_p_array["severe",1], severe, (severe/6))
dw_red_array["severe", 2] <- qnorm(dw_p_array["severe",2], severe, (severe/6))
dw_red_array["severe", 3] <- qnorm(dw_p_array["severe",3], severe, (severe/6))
dw_red_array["severe", 4] <- qnorm(dw_p_array["severe",4], severe, (severe/6))
dw_red_array["severe", 5] <- qnorm(dw_p_array["severe",5], severe, (severe/6))
return(dw_red_array)
})
change_in_daly <-  array(NA_real_,
dim = c(6,8),
dimnames = list(Year = 0:5,
DW = c("dwmild", "dwmoderate", "dwsevere", "mild", "moderate", "severe", "averted", "total dalys")))
change_in_daly_sim <- lapply(1:length(population_sim), function(i){
new_population <- population_sim[[i]]
dw_red_array <- dw_red_array_sim[[i]]
#DW
change_in_daly[1, "dwmild"] <- new_population[1, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[2, "dwmild"] <- new_population[2, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[3, "dwmild"] <- new_population[3, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[4, "dwmild"] <- new_population[4, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[5, "dwmild"] <- new_population[5, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[6, "dwmild"] <- new_population[6, "mild_population"] * `dwmild fixed` * yldmild
change_in_daly[1, "dwmoderate"] <- new_population[1, "moderate_population"] * `dwmoderate fixed` * yldmoderate
change_in_daly[2, "dwmoderate"] <- new_population[2, "moderate_population"] * `dwmoderate fixed` * yldmoderate
change_in_daly[3, "dwmoderate"] <- new_population[3, "moderate_population"] * `dwmoderate fixed` * yldmoderate
change_in_daly[4, "dwmoderate"] <- new_population[4, "moderate_population"] * `dwmoderate fixed`* yldmoderate
change_in_daly[5, "dwmoderate"] <- new_population[5, "moderate_population"] * `dwmoderate fixed` * yldmoderate
change_in_daly[6, "dwmoderate"] <- new_population[6, "moderate_population"] * `dwmoderate fixed` * yldmoderate
change_in_daly[1, "dwsevere"] <- new_population[1, "severe_population"] * `dwsevere fixed` * yldsevere
change_in_daly[2, "dwsevere"] <- new_population[2, "severe_population"] * `dwsevere fixed` * yldsevere
change_in_daly[3, "dwsevere"] <- new_population[3, "severe_population"] * `dwsevere fixed` * yldsevere
change_in_daly[4, "dwsevere"] <- new_population[4, "severe_population"] * `dwsevere fixed` * yldsevere
change_in_daly[5, "dwsevere"] <- new_population[5, "severe_population"] * `dwsevere fixed` * yldsevere
change_in_daly[6, "dwsevere"] <- new_population[6, "severe_population"] * `dwsevere fixed` * yldsevere
#DALYs
change_in_daly[2, "mild"] <- new_population[2, "mild_population"] * dw_red_array["mild", 1] * yldmild/ ((1 + discount_rate_daly) ^ 0.50)
change_in_daly[3, "mild"] <- new_population[3, "mild_population"] * dw_red_array["mild", 2] * yldmild/ ((1 + discount_rate_daly) ^ 1.50)
change_in_daly[4, "mild"] <- new_population[4, "mild_population"] * dw_red_array["mild", 3] * yldmild/ ((1 + discount_rate_daly) ^ 2.50)
change_in_daly[5, "mild"] <- new_population[5, "mild_population"] * dw_red_array["mild", 4] * yldmild/ ((1 + discount_rate_daly) ^ 3.50)
change_in_daly[6, "mild"] <- new_population[6, "mild_population"] * dw_red_array["mild", 5] * yldmild/ ((1 + discount_rate_daly) ^ 4.50)
change_in_daly[2, "moderate"] <- new_population[2, "moderate_population"] * dw_red_array["moderate", 1] * yldmoderate/ ((1 + discount_rate_daly) ^ 0.50)
change_in_daly[3, "moderate"] <- new_population[3, "moderate_population"] * dw_red_array["moderate", 2] * yldmoderate/ ((1 + discount_rate_daly) ^ 1.50)
change_in_daly[4, "moderate"] <- new_population[4, "moderate_population"] * dw_red_array["moderate", 3] * yldmoderate/ ((1 + discount_rate_daly) ^ 2.50)
change_in_daly[5, "moderate"] <- new_population[5, "moderate_population"] * dw_red_array["moderate", 4] * yldmoderate/ ((1 + discount_rate_daly) ^ 3.50)
change_in_daly[6, "moderate"] <- new_population[6, "moderate_population"] * dw_red_array["moderate", 5] * yldmoderate/ ((1 + discount_rate_daly) ^ 4.50)
change_in_daly[2, "severe"] <- new_population[2, "severe_population"] * dw_red_array["severe", 1] * yldsevere/ ((1 + discount_rate_daly) ^ 0.50)
change_in_daly[3, "severe"] <- new_population[3, "severe_population"] * dw_red_array["severe", 2] * yldsevere/ ((1 + discount_rate_daly) ^ 1.50)
change_in_daly[4, "severe"] <- new_population[4, "severe_population"] * dw_red_array["severe", 3] * yldsevere/ ((1 + discount_rate_daly) ^ 2.50)
change_in_daly[5, "severe"] <- new_population[5, "severe_population"] * dw_red_array["severe", 4] * yldsevere/ ((1 + discount_rate_daly) ^ 3.50)
change_in_daly[6, "severe"] <- new_population[6, "severe_population"] * dw_red_array["severe", 5] * yldsevere/ ((1 + discount_rate_daly) ^ 4.50)
change_in_daly[2, "averted"] <- -(change_in_daly[2, "dwmild"] - change_in_daly[1,"dwmild"] + change_in_daly[2, "dwmoderate"] - change_in_daly[1,"dwmoderate"] + change_in_daly[2,"dwsevere"] - change_in_daly[1,"dwsevere"]) / (1 + discount_rate_daly)^0.50
change_in_daly[3, "averted"] <- -(change_in_daly[3, "dwmild"] - change_in_daly[1,"dwmild"] + change_in_daly[3, "dwmoderate"] - change_in_daly[1,"dwmoderate"] + change_in_daly[3,"dwsevere"] - change_in_daly[1,"dwsevere"]) / (1 + discount_rate_daly)^1.50
change_in_daly[4, "averted"] <- -(change_in_daly[4, "dwmild"] - change_in_daly[1,"dwmild"] + change_in_daly[4, "dwmoderate"] - change_in_daly[1,"dwmoderate"] + change_in_daly[4,"dwsevere"] - change_in_daly[1,"dwsevere"]) / (1 + discount_rate_daly)^2.50
change_in_daly[5, "averted"] <- -(change_in_daly[5, "dwmild"] - change_in_daly[1,"dwmild"] + change_in_daly[5, "dwmoderate"] - change_in_daly[1,"dwmoderate"] + change_in_daly[5,"dwsevere"] - change_in_daly[1,"dwsevere"]) / (1 + discount_rate_daly)^3.50
change_in_daly[6, "averted"] <- -(change_in_daly[6, "dwmild"] - change_in_daly[1,"dwmild"] + change_in_daly[6, "dwmoderate"] - change_in_daly[1,"dwmoderate"] + change_in_daly[6,"dwsevere"] - change_in_daly[1,"dwsevere"]) / (1 + discount_rate_daly)^4.50
change_in_daly[2, "total dalys"] <- change_in_daly[2, "mild"] + change_in_daly[2, "moderate"] + change_in_daly[2, "severe"] + change_in_daly[2, "averted"]
change_in_daly[3, "total dalys"] <- change_in_daly[3, "mild"] + change_in_daly[3, "moderate"] + change_in_daly[3, "severe"] + change_in_daly[3, "averted"]
change_in_daly[4, "total dalys"] <- change_in_daly[4, "mild"] + change_in_daly[4, "moderate"] + change_in_daly[4, "severe"] + change_in_daly[4, "averted"]
change_in_daly[5, "total dalys"] <- change_in_daly[5, "mild"] + change_in_daly[5, "moderate"] + change_in_daly[5, "severe"] + change_in_daly[5, "averted"]
change_in_daly[6, "total dalys"] <- change_in_daly[6, "mild"] + change_in_daly[6, "moderate"] + change_in_daly[6, "severe"] + change_in_daly[6, "averted"]
return(change_in_daly)
})
# Calculate costs per year ------------------------------------------------
## Array costs per intervention
cost_p_array <- array(NA_real_,
dim = c(10,10),
dimnames = list(c(1:10),
P = c("prev_sub", "prev_sub_costs",
"t_mild", "t_mild_costs",
"t_mod", "t_mod_costs",
"t_sev", "t_sev_costs",
"prev_rec", "prev_rec_costs")))
cost_p_array_sim <- replicate(sim_runs, {
cost_p_array[1:10, "prev_sub"] <- runif(10, 0, 1)
cost_p_array[1:10, "t_mild"] <- runif(10, 0, 1)
cost_p_array[1:10, "t_mod"] <- runif(10, 0, 1)
cost_p_array[1:10, "t_sev"] <- runif(10, 0, 1)
cost_p_array[1:10, "prev_rec"] <- runif(10, 0, 1)
for(i in 1:10){
cost_p_array[i, "prev_sub_costs"] <- ifelse(df_prev_sub[i, "healthcare costs"] == 0,0, qgamma(p = cost_p_array[i, "prev_sub"], shape = scale_shape_gamma_cost * sqrt(df_prev_sub[i, "healthcare costs"]/scale_shape_gamma_cost), scale = sqrt(df_prev_sub[i, "healthcare costs"]/scale_shape_gamma_cost)))
cost_p_array[i, "t_mild_costs"] <- ifelse(df_tr_mild[i, "healthcare costs"] == 0,0, qgamma(p = cost_p_array[i, "t_mild"], shape = scale_shape_gamma_cost * sqrt(df_tr_mild[i, "healthcare costs"]/scale_shape_gamma_cost), scale = sqrt(df_tr_mild[i, "healthcare costs"]/scale_shape_gamma_cost)))
cost_p_array[i, "t_mod_costs"] <- ifelse(df_tr_mod[i, "healthcare costs"] == 0,0, qgamma(p = cost_p_array[i, "t_mod"], shape = scale_shape_gamma_cost * sqrt(df_tr_mod[i, "healthcare costs"]/scale_shape_gamma_cost), scale = sqrt(df_tr_mod[i, "healthcare costs"]/scale_shape_gamma_cost)))
cost_p_array[i, "t_sev_costs"] <- ifelse(df_tr_sev[i, "healthcare costs"] == 0,0, qgamma(p = cost_p_array[i, "t_sev"], shape = scale_shape_gamma_cost * sqrt(df_tr_sev[i, "healthcare costs"]/scale_shape_gamma_cost), scale = sqrt(df_tr_sev[i, "healthcare costs"]/scale_shape_gamma_cost)))
cost_p_array[i, "prev_rec_costs"] <- ifelse(df_prev_rec[i, "healthcare costs"] == 0,0, qgamma(p = cost_p_array[i, "prev_rec"], shape = scale_shape_gamma_cost * sqrt(df_prev_rec[i, "healthcare costs"]/scale_shape_gamma_cost), scale = sqrt(df_prev_rec[i, "healthcare costs"]/scale_shape_gamma_cost)))
}
return(cost_p_array)
}, simplify = FALSE)
change_in_costs <-  array(NA_real_,
dim = c(6,6),
dimnames = list(Year = 0:5,
Severity = c("incidence","mild", "moderate", "severe", "relapse", "total")))
suppressWarnings({
change_in_costs_sim <- lapply(1:length(population_sim), function(i){
new_population <- population_sim[[i]]
cost_p_array <- cost_p_array_sim[[i]]
change_in_costs[2,"incidence"] <- Incidence * (sum(df_prev_sub$cov * cost_p_array[, "prev_sub_costs"], na.rm = TRUE)) / ((1 + disc_rate_cost)^0.5)
change_in_costs[3,"incidence"] <- Incidence * (sum(df_prev_sub$cov * cost_p_array[, "prev_sub_costs"], na.rm = TRUE)) / ((1 + disc_rate_cost)^1.5)
change_in_costs[4,"incidence"] <- Incidence * (sum(df_prev_sub$cov * cost_p_array[, "prev_sub_costs"], na.rm = TRUE)) / ((1 + disc_rate_cost)^2.5)
change_in_costs[5,"incidence"] <- Incidence * (sum(df_prev_sub$cov * cost_p_array[, "prev_sub_costs"], na.rm = TRUE)) / ((1 + disc_rate_cost)^3.5)
change_in_costs[6,"incidence"] <- Incidence * (sum(df_prev_sub$cov * cost_p_array[, "prev_sub_costs"], na.rm = TRUE)) / ((1 + disc_rate_cost)^4.5)
change_in_costs[2,"mild"] <- (new_population[2, "mild_population"]) * (sum(df_tr_mild$cov * cost_p_array[ ,"t_mild_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^0.5)
change_in_costs[3,"mild"] <- (new_population[3, "mild_population"]) * (sum(df_tr_mild$cov * cost_p_array[ ,"t_mild_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^1.5)
change_in_costs[4,"mild"] <- (new_population[4, "mild_population"]) * (sum(df_tr_mild$cov * cost_p_array[ ,"t_mild_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^2.5)
change_in_costs[5,"mild"] <- (new_population[5, "mild_population"]) * (sum(df_tr_mild$cov * cost_p_array[ ,"t_mild_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^3.5)
change_in_costs[6,"mild"] <- (new_population[6, "mild_population"]) * (sum(df_tr_mild$cov * cost_p_array[ ,"t_mild_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^4.5)
change_in_costs[2,"moderate"] <- (new_population[2, "moderate_population"]) * (sum(df_tr_mod$cov * cost_p_array[ ,"t_mod_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^0.5)
change_in_costs[3,"moderate"] <- (new_population[3, "moderate_population"]) * (sum(df_tr_mod$cov * cost_p_array[ ,"t_mod_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^1.5)
change_in_costs[4,"moderate"] <- (new_population[4, "moderate_population"]) * (sum(df_tr_mod$cov * cost_p_array[ ,"t_mod_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^2.5)
change_in_costs[5,"moderate"] <- (new_population[5, "moderate_population"]) * (sum(df_tr_mod$cov * cost_p_array[ ,"t_mod_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^3.5)
change_in_costs[6,"moderate"] <- (new_population[6, "moderate_population"]) * (sum(df_tr_mod$cov * cost_p_array[ ,"t_mod_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^4.5)
change_in_costs[2,"severe"] <- (new_population[2, "severe_population"]) * (sum(df_tr_sev$cov * cost_p_array[ ,"t_sev_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^0.5)
change_in_costs[3,"severe"] <- (new_population[3, "severe_population"]) * (sum(df_tr_sev$cov * cost_p_array[ ,"t_sev_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^1.5)
change_in_costs[4,"severe"] <- (new_population[4, "severe_population"]) * (sum(df_tr_sev$cov * cost_p_array[ ,"t_sev_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^2.5)
change_in_costs[5,"severe"] <- (new_population[5, "severe_population"]) * (sum(df_tr_sev$cov * cost_p_array[ ,"t_sev_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^3.5)
change_in_costs[6,"severe"] <- (new_population[6, "severe_population"]) * (sum(df_tr_sev$cov * cost_p_array[ ,"t_sev_costs"], na.rm = TRUE)) / ((1+ disc_rate_cost)^4.5)
change_in_costs[2, "relapse"] <- (sum(new_population[1, "mild_5x_1_year"], new_population[1, "moderate_5x_1_year"], new_population[1, "severe_5x_1_year"],
new_population[1, "mild_4x_1_year"], new_population[1, "moderate_4x_1_year"], new_population[1, "severe_4x_1_year"],
new_population[1, "mild_3x_1_year"], new_population[1, "moderate_3x_1_year"], new_population[1, "severe_3x_1_year"]) * (sum(df_prev_rec$cov * cost_p_array[ ,"prev_rec_costs"], na.rm = TRUE))) / ((1 + disc_rate_cost)^0.5)
change_in_costs[3, "relapse"] <- (sum(new_population[2, "mild_5x_1_year"], new_population[2, "moderate_5x_1_year"], new_population[2, "severe_5x_1_year"],
new_population[2, "mild_4x_1_year"], new_population[2, "moderate_4x_1_year"], new_population[2, "severe_4x_1_year"],
new_population[2, "mild_3x_1_year"], new_population[2, "moderate_3x_1_year"], new_population[2, "severe_3x_1_year"]) * (sum(df_prev_rec$cov * cost_p_array[ ,"prev_rec_costs"], na.rm =TRUE))) / ((1 + disc_rate_cost)^1.5)
change_in_costs[4, "relapse"] <- (sum(new_population[3, "mild_5x_1_year"], new_population[3, "moderate_5x_1_year"], new_population[3, "severe_5x_1_year"],
new_population[3, "mild_4x_1_year"], new_population[3, "moderate_4x_1_year"], new_population[3, "severe_4x_1_year"],
new_population[3, "mild_3x_1_year"], new_population[3, "moderate_3x_1_year"], new_population[3, "severe_3x_1_year"]) * (sum(df_prev_rec$cov * cost_p_array[ ,"prev_rec_costs"], na.rm = TRUE))) / ((1 + disc_rate_cost)^2.5)
change_in_costs[5, "relapse"] <- (sum(new_population[4, "mild_5x_1_year"], new_population[4, "moderate_5x_1_year"], new_population[4, "severe_5x_1_year"],
new_population[4, "mild_4x_1_year"], new_population[4, "moderate_4x_1_year"], new_population[4, "severe_4x_1_year"],
new_population[4, "mild_3x_1_year"], new_population[4, "moderate_3x_1_year"], new_population[4, "severe_3x_1_year"]) * (sum(df_prev_rec$cov * cost_p_array[ ,"prev_rec_costs"], na.rm = TRUE))) / ((1 + disc_rate_cost)^3.5)
change_in_costs[6, "relapse"] <- (sum(new_population[5, "mild_5x_1_year"], new_population[5, "moderate_5x_1_year"], new_population[5, "severe_5x_1_year"],
new_population[5, "mild_4x_1_year"], new_population[5, "moderate_4x_1_year"], new_population[5, "severe_4x_1_year"],
new_population[5, "mild_3x_1_year"], new_population[5, "moderate_3x_1_year"], new_population[5, "severe_3x_1_year"]) * (sum(df_prev_rec$cov * cost_p_array[ ,"prev_rec_costs"], na.rm = TRUE))) / ((1 + disc_rate_cost)^4.5)
change_in_costs[,"total"] <- rowSums(change_in_costs[,c("incidence", "mild", "moderate", "severe", "relapse")])
return(change_in_costs)
})
})
# Eventual QALYs and costs for the 1000 simulations ------------------------------------------------
qaly_cost_array <- array(NA_real_,
dim = c(sim_runs, 2),
dimnames = list(Run = 1:1000,
Outcome = c("Cost", "QALYs")))
for(i in 1:sim_runs){
change_in_costs <- change_in_costs_sim[[i]]
change_in_daly <- change_in_daly_sim[[i]]
qaly_cost_array[i,"Cost"] <- sum(change_in_costs[,"total"], na.rm = TRUE)
qaly_cost_array[i, "QALYs"] <- sum(change_in_daly[,"total dalys"], na.rm = TRUE)
}
return(qaly_cost_array)
qaly_cost_array
shiny::runApp('inst/app')
runApp('inst/app')
runApp('inst/app')
runApp('inst/app')
runApp('inst/app')
runApp('inst/app')
shiny::runApp('inst/app')
runApp('inst/app')
# Base case ---------------------------------------------------------------
# Prevention: Sub-clinical depression
df_prev_sub_base <- data.frame(
cov = 0.15,
adh = 0.56,
"1-RR" = 0.21,
N = 30,
"healthcare costs" = 160,
check.names = FALSE
)
usethis::
usethis::use_data(
df_prev_sub_base,
df_prev_sub_alt,
df_tr_mild_base,
df_tr_mild_alt,
df_tr_mod_base,
df_tr_mod_alt,
df_tr_sev_base,
df_tr_sev_alt,
df_prev_rec_base,
df_prev_rec_alt,
overwrite = TRUE
)
# Base case ---------------------------------------------------------------
# Prevention: Sub-clinical depression
df_prev_sub_base <- data.frame(
cov = 0.15,
adh = 0.56,
"1-RR" = 0.21,
N = 30,
"healthcare costs" = 160,
check.names = FALSE
)
usethis::
# Base case ---------------------------------------------------------------
# Prevention: Sub-clinical depression
df_prev_sub_base <- data.frame(
cov = 0.15,
adh = 0.56,
"1-RR" = 0.21,
N = 30,
"healthcare costs" = 160,
check.names = FALSE
)
usethis::
# Prevention: Recurrent depression
df_prev_rec_alt <- data.frame(
cov = c(0.15, 0.15, 0.15),
adh = c(0.42, 0.68, 0.56),
'1-RR' = c(0.25, 0.34, 0.32),
n = c(30, 30, 30),
"healthcare costs" = c(1002, 361, 429),
check.names = FALSE
)
# Base case ---------------------------------------------------------------
# Prevention: Sub-clinical depression
df_prev_sub_base <- data.frame(
cov = 0.15,
adh = 0.56,
"1-RR" = 0.21,
N = 30,
"healthcare costs" = 160,
check.names = FALSE
)
# Treatment: Mild depression
df_tr_mild_base <- data.frame(
cov = c(0.02, 0.17),
adh = c(0.43 , 0.56),
d = c(0.33, 0.51),
n = c(30, 30),
"healthcare costs" = c(265, 962),
check.names = FALSE
)
# Treatment: Moderate depression
df_tr_mod_base <- data.frame(
cov = c(0.02, 0.16),
adh = c(0.43, 0.56),
d = c(0.33, 0.51),
n = c(30, 30),
"healthcare costs" = c(248, 901),
check.names = FALSE
)
# Treatment: Severe depression
df_tr_sev_base <- data.frame(
cov = c(0.18, 0.20, 0.20),
adh = c(0.68, 0.44, 0.56),
d = c(0.51, 0.3, 0.51),
n = c(30, 30, 30),
"healthcare costs" = c(1984, 607, 679),
check.names = FALSE)
# Prevention: Recurrent depression
df_prev_rec_base <- data.frame(
cov = c(0.15, 0.15, 0.15),
adh = c(0.42, 0.68, 0.56),
'1-RR' = c(0.25, 0.34, 0.32),
n = c(30, 30, 30),
"healthcare costs" = c(1002, 361, 429),
check.names = FALSE
)
# Alt case ----------------------------------------------------------------
# Prevention: Sub-clinical depression
df_prev_sub_alt <- data.frame(
cov = 0.15,
adh = 0.56,
"1-RR" = 0.21,
N = 30,
"healthcare costs" = 160,
check.names = FALSE
)
# Treatment: Mild depression
df_tr_mild_alt <- data.frame(
cov = c(0.02, 0.17),
adh = c(0.43 , 0.56),
d = c(0.33, 0.51),
n = c(30, 30),
"healthcare costs" = c(265, 962),
check.names = FALSE
)
# Treatment: Moderate depression
df_tr_mod_alt <- data.frame(
cov = c(0.02, 0.16),
adh = c(0.43, 0.56),
d = c(0.33, 0.51),
n = c(30, 30),
"healthcare costs" = c(248, 901),
check.names = FALSE
)
# Treatment: Severe depression
df_tr_sev_alt <- data.frame(
cov = c(0.18, 0.20, 0.20),
adh = c(0.68, 0.44, 0.56),
d = c(0.51, 0.3, 0.51),
n = c(30, 30, 30),
"healthcare costs" = c(1984, 607, 679),
check.names = FALSE)
# Prevention: Recurrent depression
df_prev_rec_alt <- data.frame(
cov = c(0.15, 0.15, 0.15),
adh = c(0.42, 0.68, 0.56),
'1-RR' = c(0.25, 0.34, 0.32),
n = c(30, 30, 30),
"healthcare costs" = c(1002, 361, 429),
check.names = FALSE
)
usethis::use_data(
df_prev_sub_base,
df_prev_sub_alt,
df_tr_mild_base,
df_tr_mild_alt,
df_tr_mod_base,
df_tr_mod_alt,
df_tr_sev_base,
df_tr_sev_alt,
df_prev_rec_base,
df_prev_rec_alt,
overwrite = TRUE
)
